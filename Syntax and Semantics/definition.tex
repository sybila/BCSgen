\documentclass{entcs}
\usepackage{prentcsmacro}
\usepackage{kpfonts}
\usepackage{hyperref}
\usepackage{algorithmicx}
\usepackage{graphicx}
\usepackage[noend]{algpseudocode}
\usepackage{mathabx}
\usepackage{leftidx}
\usepackage{pifont}

\hyphenation{me-ta-bo-lism}

% global macro definitions
\newcommand{\TBD}{\textbf{TBD}~}
\newcommand{\spec}[1]{\texttt{#1}}
\renewcommand{\~}[0]{\texttildelow}
\renewcommand{\algorithmiccomment}[1]{\hfill\textit{\# #1}}
\newcommand*\arc{{\fontfamily{pbk}\fontseries{db}\selectfont+}}
\newcommand{\pipe}{{}{\scalebox{.6}{$|$}}{}}
\newcommand{\choice}{|}

\newtheorem{notation}[thm]{Notation}

\def\lastname{Troj\'{a}k et al.}

\begin{document}

% title page
\begin{frontmatter}
\title{Formal Biochemical Space Language}

\author{\normalsize
T. D\v{e}d, D. \v{S}afr\'anek, M. Troj\'ak, M. Klement, J. \v{S}alagovi\v{c}, L. Brim}
\address{Faculty of Informatics, Masaryk University\\
Brno, Czech Republic
}

\end{frontmatter}

\section{Biochemical Space Agents}

Let $\mathcal{N}_{A},~\mathcal{N}_{T},~\mathcal{N}_{X},~\mathcal{N}_{c},~\mathcal{N}_{s}$ be mutually exclusive finite sets of atomic, structure, complex, compartment, and state names, respectively. 

\subsection{Atomic agents}

Agents are defined hierarchically starting from \emph{atomic agents}. These agents are the smallest units in our hierarchy and represent ...

\begin{defn}
Atomic agent $\mathtt{A}$ is defined as triple ($\alpha, \delta, \mathtt{c}$) where $\alpha \in \mathcal{N}_{A}$ is name, $\delta \subseteq \mathcal{N}_{s}$ is finite non-empty set of states $\mathtt{s} \in \mathcal{N}_{s}$, and $\mathtt{c} \in \mathcal{N}_{c}$ is physical compartment within which it is considered.
\end{defn}

\begin{defn}
Let $\mathtt{A},~\mathtt{A}'$ be atomic agents. We define the \emph{equivalence of atomic agents} by claiming $\mathtt{A}\equiv\mathtt{A}'$ whenever $\mathtt{\alpha} = \mathtt{\alpha}'$, $\mathtt{c} = \mathtt{c}'$ and $\delta = \delta'$.
\end{defn}

\begin{defn}
Let $\mathtt{A},\mathtt{A}'$ be atomic agents. We say agent $\mathtt{A}=(\alpha, \delta, \mathtt{c})$ is \emph{compatible with} agent $\mathtt{A}'=(\alpha', \delta', \mathtt{c}')$, written $\mathtt{A} \lhd \mathtt{A}'$, iff $\alpha = \alpha'$, $\mathtt{c} = \mathtt{c}'$, and $\delta \subseteq \delta'$. 
\end{defn}

\begin{notation}
{~}
\begin{itemize}
\item We denote $\mathtt{s}\in\delta$ the fact that $\mathtt{s}$ is included in the state signature~$\delta$.
\item We denote $\mathtt{c}(\mathtt{A})$ the fact that $\mathtt{A}$ is in compartment $\mathtt{c}$.
\end{itemize}
\end{notation}

Atomic agent expressions have the following syntax:

\begin{center}
{\small
\hspace*{-1cm}\begin{tabular}{ ll ll ll ll }
 atomic agent expression & $\mathtt{A} ::= \alpha\{\delta\}::\mathtt{c}$ & states & $ \delta ::= s_1, s_2, ..., s_m$ \\
 name & $\alpha ::= n \in \mathcal{N}_{A}$  & state & $\mathtt{s}_i ::= n \in \mathcal{N}_{s}$\\
 compartment & $\mathtt{c} ::= n \in \mathcal{N}_{c}$\\
\end{tabular}
}
\end{center}

\begin{notation}
{~}
\begin{itemize}
\item Note that an atomic agent expression fully defines an atomic agent. However, an atomic agent might be written by more expressions due to order in enumerated states. We denote $\Upsilon_\mathtt{A}$ as set of all possible atomic agent expressions created from atomic agent $\mathtt{A}$ (all possible orders in states).
\end{itemize}
\end{notation}

\begin{theorem}
Since atomic agents are constructed from finite sets $\mathcal{N}_{A},~\mathcal{N}_{c}$, and $\mathcal{N}_{s}$, we can define finite universe of atomic agents $\mathcal{A} = \{ \mathtt{A}~|~\mathtt{A} = (\alpha, \delta, \mathtt{c}), \alpha~\in~\mathcal{N}_{A}, \delta~\subseteq~\mathcal{N}_{s},  \mathtt{c}~\in~\mathcal{N}_{c} \}$. 

\noindent Similarly, we can define finite universe of atomic agent expressions\\ $\mathcal{E}_\mathcal{A} = \{ \alpha\{\delta\}::\mathtt{c} ~|~ (\alpha, \delta, \mathtt{c}) \in \mathcal{A} \} $.
\end{theorem}

\subsection{Structure agents}

Next we proceed with defining \emph{structure agents}. A structure agent represents a biochemical object that is composed from several known atomic agents provided that we know that such a composition is abstract and not necessarily complete. To incorporate such an abstraction of biological structures into our language, a structure agent is defined to be labelled with a unique name and it is constructed only from atomic agents considered in the same physical compartment. 

A typical example of a structure agent is a protein where the atomic agents are individual amino acids that are of interest in the particular setting.

\begin{defn}
Structure agent $\mathtt{T}$ is defined as triple ($\tau, \gamma_p, \mathtt{c}$) where $\tau \in \mathcal{N}_{T}$ is name, $\gamma_p \subseteq \mathcal{A}$ is finite set of atomic agents $\mathtt{A} \in \mathcal{A}$ called \emph{partial composition}, and $\mathtt{c} \in \mathcal{N}_{c}$ is physical compartment within which it is considered. Moreover, two atomic agents with the same name cannot appear in partial composition.
\end{defn}

\begin{notation}
{~}
\begin{itemize}
\item We denote $\mathtt{A} \in \mathtt{T}$ the fact that $\mathtt{A}$ is included in partial composition $\gamma_p$ of structure agent $\mathtt{T}$.
\item We denote $\mathtt{c}(\mathtt{T})$ the fact that $\mathtt{T}$ is in compartment $\mathtt{c}$.
\end{itemize}
\end{notation}

\begin{defn}
Let $\mathtt{T},\mathtt{T}'$ be structure agents. We define the \emph{equivalence of structure agents} by claiming $\mathtt{T}\equiv\mathtt{T}'$ iff there exist $\tau,\tau',\gamma_p,\gamma'_p,\mathtt{c},\mathtt{c}'$ such that $\mathtt{T}=(\tau, \gamma_p, \mathtt{c}),\mathtt{T}'=(\tau', \gamma_p', \mathtt{c}')$, $\tau=\tau'$, $\mathtt{c} = \mathtt{c}'$, and $\gamma_p=\gamma'_p$.
\end{defn}

\begin{defn}
Let $\mathtt{T},\mathtt{T}'$ be structure agents. We say $\mathtt{T}$ \emph{is compatible with} $\mathtt{T}'$, written $\mathtt{T} \lhd \mathtt{T}'$, iff there exist $\tau,\tau',\gamma_p,\gamma'_p,\mathtt{c},\mathtt{c}'$ such that $\mathtt{T}=(\tau, \gamma_p, \mathtt{c}),\mathtt{T}'=(\tau', \gamma_p', \mathtt{c}')$, $\tau = \tau'$, $\mathtt{c} = \mathtt{c}'$, and for each atomic agent $\mathtt{A} \in \gamma_p$ there exists an atomic agent $\mathtt{A}' \in \gamma'_p$ such that $\mathtt{A}~\lhd~\mathtt{A}'$. 
\end{defn}

Structure agent expressions have the following syntax:

\begin{center}
{\small
\hspace*{-1cm}\begin{tabular}{ l l l l }
 structure agent expression & $\mathtt{T} ::= \tau(\gamma_p)::\mathtt{c}$ & structure name & $\tau ::= n \in \mathcal{N}_{T}$\\
 partial composition & $\gamma_p ::= \mathtt{A}_1, \mathtt{A}_2, ..., \mathtt{A}_m$ & atomic agent & $\mathtt{A}_i ::= n \in \mathcal{E}_\mathcal{A}$\\
 & & compartment & $\mathtt{c} ::= n \in \mathcal{N}_{c}$\\
\end{tabular}
}
\end{center}   

\begin{notation}
~
\begin{itemize}
\item Note that a compartment of a structure agent is uniquely given by the compartment specified in its parts. We restrict ourselves to structure agents where all atomic agents in the partial composition have the same compartment. Assuming this restriction, we can shorten the notation by omitting compartments in the atomic agent expressions of a partial composition. 
\item Note that a structure agent expression fully defines a structure agent. However, a structure agent might be written by more expressions due to order in partial composition. We denote $\Upsilon_\mathtt{T}$ as set of all possible structure agent expressions created from structure agent $\mathtt{T}$ (all possible orders in composition).
\end{itemize}
\end{notation}

\begin{theorem}
Since structure agents are constructed from finite sets $\mathcal{N}_{T},~\mathcal{N}_{c}$, and $\mathcal{A}$, we can define finite universe of structure agents

 $\mathcal{T} = \{ \mathtt{T}~|~\mathtt{T} = (\tau, \gamma_p, \mathtt{c}), \tau~\in~\mathcal{N}_{T}, \gamma_p~\subseteq~\mathcal{A},  \mathtt{c}~\in~\mathcal{N}_{c} \}$.

\noindent Similarly, we can define finite universe of structure agent expressions

 $\mathcal{E}_\mathcal{T} = \{ \tau(\gamma_p)::\mathtt{c} ~|~ (\tau, \gamma_p, \mathtt{c}) \in \mathcal{T} \}$.
\end{theorem}

\subsection{Complex agents}

In the following we define the last step in the hierarchy of agents. In particular, we define \textit{complex agents}. A complex agent represents a non-trivial composite biochemical object that is (inductively) constructed from already known biological objects. In common rule-based languages this is typically defined by introducing some kind of bonds between individual biochemical objects. In BCS we abstract from detailed specification of bonds and we rather assume a complex as a coexistence of certain objects in a particular group. Such a group can be optionally referred to by a unique name. A complex agent is constructed from atomic and structure agents.

\begin{defn}
Complex agent $\mathtt{X}$ is defined as pair ($\gamma_f, \mathtt{c}$) where $\gamma_f \subseteq \mathcal{A} \cup \mathcal{T}$ is finite multiset of atomic and structure agents called \emph{full composition} and $\mathtt{c} \in \mathcal{N}_{c}$ is physical compartment within which it is considered.
\end{defn}

\begin{notation}
~
\begin{itemize}
\item  We denote $\mathtt{T} \in \mathtt{X}$ (resp. $\mathtt{A}\in \mathtt{X}$) the fact that~$\mathtt{T}$ (resp. $\mathtt{A}$) is a structure agent (resp. atomic agent) included in~$\gamma_f$ of complex agent $\mathtt{X}$. 
\item We denote $\mathtt{c}(\mathtt{X})$ the fact that $\mathtt{X}$ is in compartment $\mathtt{c}$.
\end{itemize}
\end{notation}

\begin{defn}
Let $\mathtt{X},\mathtt{X}'$ be structure agents. We define the \emph{equivalence of structure agents} by claiming $\mathtt{X} \equiv \mathtt{X}'$ iff there exist $\gamma_f,\gamma'_f, \mathtt{c},\mathtt{c}'$ such that $\mathtt{X}=(\gamma_f, \mathtt{c}),\mathtt{T}'=(\gamma_f', \mathtt{c}')$, $\mathtt{c} = \mathtt{c}'$, and $\gamma_f=\gamma'_f$.
\end{defn}

Complex agent expressions have the following syntax:

\begin{center}
{\small
\hspace*{-1 cm}\begin{tabular}{ l l l l }
 complex agent expression & $\mathtt{X}::=\gamma_f::\mathtt{c}$ & compartment & $\mathtt{c} ::= n \in \mathcal{N}_{c}$\\
 full composition & $\gamma_f ::= \beta_1.\beta_2.~...~.\beta_m$ & agent & $\beta_i ::= n \in \mathcal{E}_\mathcal{T}~\choice~n \in \mathcal{E}_\mathcal{A}$
\end{tabular}
}
\end{center}

\begin{notation}
~
\begin{itemize}
\item Note that a compartment of a complex agent is uniquely given by the compartment specified in its parts. We restrict ourselves to complex agents where all atomic and structure agents in the full composition have the same compartment. Assuming this restriction, we can shorten the notation by omitting compartments in the atomic and structure agent expressions of a full composition. 
\item Note that an complex agent expression fully defines a complex agent. However, a complex agent might be written by more expressions due to order in full composition. We denote $\Upsilon_\mathtt{X}$ as set of all possible complex agent expressions created from complex agent $\mathtt{X}$ (all possible orders in composition).
\end{itemize}
\end{notation}

\begin{defn}
Let $\mathtt{X},\mathtt{X}'$ be complex agents expressions. We say $\mathtt{X}$ \emph{is compatible with} $\mathtt{X}'$, written $\mathtt{X} \lhd \mathtt{X}'$, iff $\mathtt{X} = \beta_1 . \beta_2 . ... . \beta_n $, $\mathtt{X}' = \beta'_1 . \beta'_2 . ... . \beta'_n $ and \\$\forall \beta_1, \beta_2, ..., \beta_n~\in~\mathtt{X} ~\&~ \forall \beta_1', \beta_2', ..., \beta_n'~\in~\mathtt{X}'$ : $\beta_i \lhd \beta_i'$. Moreover, $\mathtt{c}(\mathtt{X}) = \mathtt{c}(\mathtt{X}')$.
\end{defn}

\begin{theorem}
Since complex agents are constructed from finite sets $\mathcal{N}_{c}$, $\mathcal{A}$, and $\mathcal{T}$, we can define finite universe of complex agents 

$\mathcal{X} = \{ \mathtt{X}~|~\mathtt{X} = (\gamma_f, \mathtt{c}), \gamma_f \subseteq \mathcal{A} \cup \mathcal{T},  \mathtt{c}~\in~\mathcal{N}_{c} \}$.

\noindent Similarly, we can define finite universe of complex agent expressions

 $\mathcal{E}_\mathcal{X} = \{ \gamma_f::\mathtt{c} ~|~ (\gamma_f, \mathtt{c}) \in \mathcal{X} \}$.
\end{theorem}

\subsection{Summary}

\begin{defn}
We define finite universe of all agents $\mathcal{U} = \mathcal{A} \cup \mathcal{T} \cup \mathcal{X}.$

\noindent Finally, we define finite universe of all agent expressions $\mathcal{E} = \mathcal{E}_\mathcal{A} \cup \mathcal{E}_\mathcal{T} \cup \mathcal{E}_\mathcal{X} \cup \{\varepsilon\}$.
\end{defn}

\begin{notation}
~
\begin{itemize}
\item Since an expression uniquely defines an agent, we can use compatibility operator between agent expressions.
\end{itemize}
\end{notation}

\section{Biochemical Space Rules}

%\begin{defn}
%Rule $\mathtt{R}$ is defined as pair ($\lambda, \rho$) where $\lambda, \rho \subseteq \mathcal{E}$ and $\lambda$ is \emph{left-hand-side} of the rule and $\rho$ is \emph{right-hand-side} of the rule. Both $\lambda$ and $\rho$ are ordered sets where order is given by rule expression and at most one of them might be $\varepsilon$.
%\end{defn}

Rule is defined as an expression constructed from agent expressions by the following grammar:

\begin{center}
{\small
\hspace*{-1cm}\begin{tabular}{ l l }
 rule expression & $\mathtt{R} ::= \lambda ~\Rightarrow~ \rho ~|~ \lambda ~\Rightarrow ~|~ \Rightarrow~ \rho $\\
 right-hand-side & $\lambda ::= \Gamma$\\
 left-hand-side & $\rho ::= \Gamma$\\
 agent enumeration & $\Gamma ::= \varphi~ +~\Gamma ~|~ \varphi$\\
 rule agent & $\varphi :: = n \in \mathcal{E}_\mathcal{A}~\choice~n \in \mathcal{E}_\mathcal{T}~\choice~n \in \mathcal{E}_\mathcal{X}$\\
\end{tabular}
}
\end{center}

\begin{notation}
Agent enumeration $\Gamma$ is an expression of form $\varphi_1 + \varphi_2 + ... + \varphi_n$. From now, when referencing it, it might be treated as a tuple $(\varphi_1, \varphi_2, ..., \varphi_n)$. Moreover, each rule agent $\varphi_i$ is an agent expression which fully defines its agent. For this reason, the tuple can be treated as tuple of agents. 
\end{notation} \label{mynote}

\begin{defn}
Let $\mathtt{R},\mathtt{R}'$ be rules. We define the \emph{structural equivalence of rules} by claiming $\mathtt{R} \equiv \mathtt{R}'$ iff TBA...
\end{defn}

\begin{theorem}
We define (potentially infinite) universe of rule expressions $\mathcal{E}_\mathcal{R} $ as all possible rule expressions which can be constucted.
\end{theorem}

\section{Semantics}

How is semantics being applied on a model does not matter now. Briefly, using an algorithm, we choose a solution from given state and apply a rule on this solution. This step is quite forward and does not need any deeper explanation (might be done later). What has to be defined is application of the rule on the solution.

Let $\beta$ be an agent, $\mathtt{R} \in \mathcal{E}_\mathcal{R}$ be a rule of form $\lambda \Rightarrow \rho$ where $\lambda$ and $\rho$ are agent enumerations, and $\mathtt{S} \subseteq \mathcal{U}$ be a solution. 

\begin{defn}
For a given solution $\mathtt{S}$, we denote $\Upsilon_\mathtt{S}$ as set of all possible agent enumerations constructed from $\Upsilon_\mathtt{A}$, $\Upsilon_\mathtt{T}$, and $\Upsilon_\mathtt{X}$ for particular agents in $\mathtt{S}$. We denote $\mathtt{S}_\Upsilon$ an element in $\Upsilon_\mathtt{S}$.
\end{defn}

\begin{notation}
At this point, it is good to sumarize what a $\mathtt{S}_\Upsilon$ actually is. Since $\Upsilon_\mathtt{S}$ is set of all possible agent enumerations, $\mathtt{S}_\Upsilon$ is an agent enumeration $\Gamma$. According to Notation~\ref{mynote}, it can be treated as a tuple of rule agents $(\varphi_1, \varphi_2, ..., \varphi_n)$. Moreover, a special case occurs when the tuple has a single item, i.e. single rule agent.
\end{notation}

\begin{defn}
$ $ \\
\emph{Matching} is a relation denoted as $\models \subseteq \Gamma \times \Gamma$ and defined inductively in the left column below.
    \emph{Replacement} is a function $\Gamma \times \Gamma \rightarrow \Gamma$ defined in the right column below: 

    \begin{center}
{\scriptsize
\begin{tabular}{ c | | c | l }
	Matching & Replacement & Conditions \\

	\hline

    $ \frac{\mathtt{A}_\mathtt{S}~\lhd~\mathtt{A}_{\lambda}}{\mathtt{A}_\mathtt{S}~\models~\mathtt{A}_{\lambda}}$ & 
    $ \mathtt{A}_\mathtt{S}[\mathtt{A}_\rho] = \mathtt{A}_\mathtt{R} $ & 
    $ \mathtt{A}_\mathtt{S} = \alpha_\mathtt{S}\{p\}::c_\mathtt{S}$ ~~~~~ $ \alpha_\mathtt{S} = \alpha_\rho = \alpha_\mathtt{R}$ \\

     &  & $\mathtt{A}_\rho = \alpha_\rho\{t\}::c_\rho$ ~~~~~ $p \neq t$ \\
     &  & $\mathtt{A}_\mathtt{R} = \alpha_\mathtt{R}\{t\}::c_\mathtt{R}$ ~~~~~ $ c_\mathtt{S} = c_\rho = c_\mathtt{R}$\\

    \hline

    $\frac{\mathtt{T}_\mathtt{S}~\lhd~\mathtt{T}_{\lambda}}{\mathtt{T}_\mathtt{S}~\models~\mathtt{T}_{\lambda}}$ & 
    $ \mathtt{T}_\mathtt{S}[\mathtt{T}_\rho] = \mathtt{T}_\mathtt{R} $ & 
    $ \mathtt{T}_\mathtt{S} = \tau(\gamma_{p_\mathtt{S}})::\mathtt{c}$ ~~~~~ $ \gamma_{p_\mathtt{S}} = \mathtt{A}_\mathtt{S_1}, \mathtt{A}_\mathtt{S_2}, ..., \mathtt{A}_\mathtt{S_n} $\\

     &  & $ \mathtt{T}_\rho = \tau(\gamma_{p_\rho})::\mathtt{c}$ ~~~~~ $ \gamma_{p_\rho} = \mathtt{A}_{\rho_1}, \mathtt{A}_{\rho_2}, ..., \mathtt{A}_{\rho_n} $ \\
     &  & $\mathtt{T}_\mathtt{R} = \tau(\gamma_{p_\mathtt{R}})::\mathtt{c} $ ~~~~~ $\gamma_{p_\mathtt{R}} = \mathtt{A}_\mathtt{S_1}[\mathtt{A}_{\rho_1}], \mathtt{A}_\mathtt{S_2}[\mathtt{A}_{\rho_2}],... , \mathtt{A}_\mathtt{S_n}[\mathtt{A}_{\rho_n}]$ \\

    \hline

    $\frac{\mathtt{X}_\mathtt{S}~\lhd~\mathtt{X}_{\lambda}}{\mathtt{X}_\mathtt{S}~\models~\mathtt{X}_{\lambda}}$ & 
    $ \mathtt{X}_\mathtt{S}[\mathtt{X}_\rho] = \mathtt{X}_\mathtt{R} $ & 
    $ \mathtt{X}_\mathtt{S} = \gamma_{f_\mathtt{S}}::c$ ~~~~~ $ \mathtt{X}_\rho = \gamma_{f_\rho}::c $ ~~~~~ $ \mathtt{X}_\mathtt{R} = \gamma_{f_\mathtt{R}}::c $\\

     &  & $\gamma_{f_\mathtt{R}} = \beta_1.\beta_2.~...~.\beta_n : \forall y_i \in \gamma_{f_\mathtt{S}}$ and $ \forall z_i \in \gamma_{f_\rho} : \beta_i = y_i[z_i]$ \\

    \hline

     & 
    $ \alpha_\mathtt{S}\{p\}::c[\alpha_\rho\{t\}::c] = \alpha_\mathtt{\mathtt{S}}\{t\}::c $ & 
    $\mathtt{A}_\mathtt{S} = \alpha_\mathtt{S}\{p\}::c$ ~~~~~ $ \alpha_\mathtt{S} = \alpha_\rho $ \\

     &  & $\mathtt{A}_\rho = \alpha_\rho\{t\}::c$ ~~~~~ $p \neq t$ \\

    \hline
    \end{tabular}}
    \end{center}

\end{defn}


% \begin{enumerate}
% \item \textbf{Matching} as a function $\models ~: \Upsilon_\mathtt{S}~\bigtimes~\lambda~\rightarrow~\Upsilon_\mathtt{S}^{\models}$ defined particularly:

% \begin{itemize}
% 	\item $\mathtt{A}_\mathtt{S} \models \mathtt{A}_{\lambda} \Leftrightarrow \mathtt{A}_\mathtt{S} \lhd \mathtt{A}_{\lambda}$,
% 	\item $\mathtt{T}_\mathtt{S} \models \mathtt{T}_{\lambda} \Leftrightarrow \mathtt{T}_\mathtt{S} \lhd \mathtt{T}_{\lambda}$,
% 	\item $\mathtt{X}_\mathtt{S} \models \mathtt{X}_{\lambda} \Leftrightarrow $ .
% \end{itemize}
% \noindent The resulting set $\Upsilon_\mathtt{S}^{\models}$ contains all those expressions from $\Upsilon_\mathtt{S}$ which match \emph{left-hand-side} $\lambda$ of the rule $\mathtt{R}$.

% \item \textbf{Replacement} as a (partial) function $\Upsilon_\mathtt{S}^{\models}~\times~\rho~\rightarrow~\Upsilon_\mathtt{R}$, where $\Upsilon_\mathtt{R}$ is set of agent enumerations created according to six replacement categories:

% \begin{enumerate}
% \item \textit{state change }:

% \begin{itemize}
% \item $ \pmb{\alpha_\mathtt{S}\{p\}::c[\alpha_\rho\{t\}::c] = \alpha_\mathtt{\mathtt{S}}\{t\}::c} $

% where $ \alpha_\mathtt{S} = \alpha_\rho $ and $p \neq t$.

% \item $ \pmb{\mathtt{T}_\mathtt{S}::c[\mathtt{T}_\rho::c] = \mathtt{T}_\mathtt{R}::c}$ 

% $\mathtt{T}_\mathtt{R} = \mathtt{A}_{\mathtt{R}_1}, \mathtt{A}_{\mathtt{R}_2}, ..., \mathtt{A}_{\mathtt{R}_n} : \mathtt{A}_{\mathtt{R}_1} = \alpha_\mathtt{S}\{p\}::c[\alpha_\rho\{t\}::c]$

% and $\alpha_\rho\{t\} \in \mathtt{T}_\rho, ~\alpha_\mathtt{S}\{p\} \in \mathtt{T}_\mathtt{S} $ and $\alpha_\mathtt{S} = \alpha_\rho$.

% \item $ \pmb{\mathtt{X}_\mathtt{S}::c[\mathtt{X}_\rho::c] = \mathtt{X}_\mathtt{R}::c}$

% $ \mathtt{X}_\mathtt{R} = \beta_1.\beta_2. ~...~ .\beta_n \pmb{:} \forall y_1, y_2, ..., y_n \in \mathtt{X}_\mathtt{S}~and~z_1, z_2, ..., z_n \in \mathtt{X}_\rho \pmb{:}$

% $\beta_i = y_i::c~[z_i::c].$

% \end{itemize}

% \item \textit{complex formation}:

% \begin{itemize}
% \item $\pmb{\mathtt{S}_\Upsilon[\mathtt{X}_\rho::c] = \mathtt{X}_\mathtt{R}::c}$

% $\mathtt{X}_\mathtt{R} = \beta_1.\beta_2. ~...~ .\beta_n \pmb{:} \forall \beta_i::c \in \mathtt{S}_\Upsilon.$

% \end{itemize}

% \item \textit{complex dissociation}:

% \begin{itemize}
% \item $ \pmb{\mathtt{X}_\mathtt{S}::c[\rho] = \mathtt{R}_\Upsilon}$ 

% $\rho = \beta_{\rho_1}::c + \beta_{\rho_2}::c + ~...~ + {\rho_n}::c$ and $\mathtt{X}_\mathtt{S} = \beta_{\mathtt{S}_1}.\beta_{\mathtt{S}_2}. ~...~ .{\mathtt{S}_n}::c$.

% $\mathtt{R}_\Upsilon = \beta_{\mathtt{R}_1}::c + \beta_{\mathtt{R}o_2}::c + ~...~ + {\mathtt{R}_n}::c \pmb{:}$ $ \beta_{\mathtt{R}_i} = \beta_{\mathtt{S}_i} \Leftrightarrow \beta_{\mathtt{S}_i} \models \beta_{\rho_i}.$

% \end{itemize}

% \item \textit{degradation}
% \begin{itemize}
% \item $  \pmb{\mathtt{S}_\Upsilon[\emptyset] = \emptyset} $
% \end{itemize}

% \item \textit{translation}
% \begin{itemize}
% \item $ \pmb{\emptyset[\rho] = \rho} $
% \end{itemize}

% \item \textit{transport}:
% \begin{itemize}
% \item $ \pmb{\beta_\mathtt{S}::c_\mathtt{S}[\beta_\rho::c_\rho] = \beta_\mathtt{S}::c_\rho} $

% where $\beta_\mathtt{S} = \beta_\rho$ and $ c_\mathtt{S} \neq c_\rho $.
% \end{itemize}

% \end{enumerate}
% \end{enumerate}
% \end{defn}

\section{Syntactic extensions}

We define several syntactic extensions for better readability of the rules. Note that each rule in a extended form can be always translated to basic form defined above. All rules containing the following extensions must be converted to basic form before semantics can be applied.

\subsection{Signatures}

Signatures are used for associating properties to agent names.

\begin{defn}
Atomic agent signature $\Sigma_\mathtt{A}$ is triple ($\alpha, \mathcal{M}_\delta, \mathcal{M}_c$) where $\alpha \in \mathcal{N}_{A}$ is name, $\delta \subseteq \mathcal{N}_{s}$ is finite non-empty set of states $\mathtt{s} \in \mathcal{N}_{s}$, and $\mathcal{M}_c \subseteq \mathcal{N}_{c}$ is set of compartments. It restricts each atomic agent $\mathtt{A}$ with name $\alpha$ to have its $\delta \subseteq \mathcal{M}_\delta$ and its $\mathtt{c} \in \mathcal{M}_c$. 
\end{defn}

\begin{notation}
If an atomic agent $\mathtt{A} = (\alpha, \delta, \mathtt{c})$ has defined its agent signature $\Sigma_\mathtt{A}$ = ($\alpha, \mathcal{M}_\delta, \mathcal{M}_c$), then maximal set $\mathcal{M}_\delta$ of states is defined. For this reason, we can reference agent $\mathtt{A}$ with $\delta = \mathcal{M}_\delta$ as $\alpha::\mathtt{c}$ since $\delta$ can be reconstructed from $\Sigma_\mathtt{A}$.
\end{notation}

\begin{defn}
Structure agent signature $\Sigma_\mathtt{T}$ is triple ($\tau, \mathcal{M}_{\gamma_p}, \mathcal{M}_c$) where $\tau \in \mathcal{N}_{T}$ is name, $\mathcal{M}_{\gamma_p} \subseteq \mathcal{T}$ is finite set of atomic agents $\mathtt{A} \in \mathcal{A}$, and $\mathcal{M}_c \subseteq \mathcal{N}_{c}$ is set of compartments. It restricts each structure agent $\mathtt{T}$ with name $\tau$ to have $\gamma_p$ such that for each atomic agent $\mathtt{A} \in \gamma_p$ there exists an atomic agent $\mathtt{A}' \in \mathcal{M}_{\gamma_p}$ such that $\mathtt{A}~\lhd~\mathtt{A}'$. We denote this fact as $\gamma_p \lhd \mathcal{M}_{\gamma_p}$. Moreover, it restricts its compartment to $\mathtt{c} \in \mathcal{M}_c$. 
\end{defn}

\begin{notation}
If a structure agent $\mathtt{T} = (\tau, \gamma_p, \mathtt{c})$ has defined its agent signature $\Sigma_\mathtt{T}$ = ($\tau, \mathcal{M}_{\gamma_p}, \mathcal{M}_c$), then required composition $\mathcal{M}_{\gamma_p}$ is defined. For this reason, when referencing agent $\mathtt{T}$ with $\gamma_p \lhd \mathcal{M}_{\gamma_p}$, we can skip all those atomic agents $\mathtt{A} = (\alpha, \delta, \mathtt{c})$, which have defined its agent signature $\Sigma_\mathtt{A} = (\alpha, \mathcal{M}_\delta, \mathcal{M}_c)$ and $\delta = \mathcal{M}_\delta$. They can be reconstructed from $\Sigma_\mathtt{T}$.
\end{notation}

\begin{defn}
Complex agent signature $\Sigma_\mathtt{X}$ is pair ($\chi, \mathcal{M}_{\gamma_f}$) where $\chi \in \mathcal{N}_{X}$ is name, $\mathcal{M}_{\gamma_f} \subseteq \mathcal{A} \cup \mathcal{T}$ is finite multiset of atomic and structure agents. It associates a name to complex agent $\mathtt{X} = (\gamma_f, \mathtt{c})$ with $\gamma_f = \mathcal{M}_{\gamma_f}$.
\end{defn}

\begin{notation}
If a complex agent $\mathtt{X} = (\gamma_f, \mathtt{c})$ has defined its agent signature $\Sigma_\mathtt{X}$ = ($\chi, \mathcal{M}_{\gamma_f}$). Then, the agent can be referenced using $\chi$ instead of full composition and it can be reconstructed from $\Sigma_\mathtt{X}$.
\end{notation}

\subsection{Direction}

We allow rules to be bi-directional -- it is just a shortcut for two rules and it can be converted to basic rule form. A rule $\mathtt{R} = \lambda ~\Leftrightarrow~ \rho$ might be written as two rules $\mathtt{R}_1 = \lambda ~\Rightarrow~ \rho$ and $\mathtt{R}_2 = \rho ~\Rightarrow~ \lambda$. Similarly for all rule forms.

\subsection{Stoichiometry}

In agent enumeration $\Gamma = (\varphi_1, \varphi_2, ..., \varphi_n)$, we enrich $\varphi_i$ context to pair $(\zeta, \varphi_i)$ where $\zeta = 1$. However, some rule agents in $\Gamma$ might be equivalent. For this reason, there are equivalence groups $\mathcal{G}_\equiv$ of \textit{k} rule agents $\varphi_i, ..., \varphi_j$. Each of these groups $\mathcal{G}_\equiv$ might be written as one pair $(\zeta, \varphi_i)$ where $\zeta = k$ for some $\varphi_m \in \mathcal{G}_\equiv$.

Note that this process is fully reversible, so agent enumeration in basic form can be easily reconstructed.

\subsection{Locations}

\begin{defn}
We define operator `::' between two rule agents:

\begin{enumerate}
 \item $\mathtt{A}::\mathtt{T}$ $\Leftrightarrow$ there exists $\mathtt{A}' \in \mathtt{T}$ such that $\mathtt{A} \lhd \mathtt{A}'$ and $\mathtt{c}(\mathtt{A}) = \mathtt{c}(\mathtt{T})$,

\item $\mathtt{A}::\mathtt{X}$ $\Leftrightarrow$ there exists $\mathtt{A}' \in \mathtt{X}$ such that $\mathtt{A} \lhd \mathtt{A}'$ and $\mathtt{c}(\mathtt{A}) = \mathtt{c}(\mathtt{X})$,

\item $\mathtt{T}::\mathtt{X}$ $\Leftrightarrow$ there exists $\mathtt{T}' \in \mathtt{X}$ such that $\mathtt{T} \lhd \mathtt{T}'$ and $\mathtt{c}(\mathtt{T}) = \mathtt{c}(\mathtt{X})$,

\item $\mathtt{X}'::\mathtt{X}$ $\Leftrightarrow$ there exists subexpression $\mathtt{X}'' \in \mathtt{X}$ such that $\forall \beta_1', \beta_2', ..., \beta_n' \in \mathtt{X}' $ \& $\forall \beta_1'', \beta_2'', ..., \beta_n'' \in \mathtt{X}''$ : $\beta_i' \lhd \beta_i''$.

\end{enumerate}
\end{defn}

Then, each rule agent $\varphi$ can be written by the following grammar with respect to operator `::' definition:

\begin{center}
{\small
\hspace*{-1cm}\begin{tabular}{ l }
$\varphi :: = \varphi :: \varphi~|~\widehat{\varphi}$\\
$\widehat{\varphi} ::= \mathtt{A}~|~\mathtt{T}~|~\mathtt{X}$\\
\end{tabular}
}
\end{center}

\begin{notation}
Note that a compartment of all agents is restricted to be the same. Assuming this restriction, we can shorten the notation by omitting compartments in all agents except the most right one.
\end{notation}

\subsection{Variables}

In a rule, one rule agent might be referenced using variable $\upsilon$ as a set of agents it can be replaced with. Such a rule agent is referenced as $?X$. The appropriate set of agents is referenced via following grammar: 

\begin{center}
{\small
\hspace*{-1cm}\begin{tabular}{ l }
$\mathtt{R} ::= \lambda ~\Rightarrow~ \rho~\nu ~|~ \Rightarrow ~\odot~\nu ~|~ \Rightarrow~ \rho~\nu $\\
$\nu ::=~ ;~\upsilon$\\
$\upsilon ::=~?X = \{\phi\}$\\
$\phi ::=~\phi_1~|~\phi_2~|~\phi_3$\\
$\phi_1 ::= \mathtt{A},~\phi_1~|~\mathtt{A}$\\
$\phi_2 ::= \mathtt{T},~\phi_2~|~\mathtt{T}$\\
$\phi_3 ::= \mathtt{X},~\phi_3~|~\mathtt{X}$\\
\end{tabular}
}
\end{center}

Once again, each rule associated with variable can be easily rewritten as several rules where variable is replaced with agent from set of agents attached to the variable.

\end{document}
