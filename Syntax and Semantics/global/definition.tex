\documentclass{entcs}
\usepackage{prentcsmacro}
\usepackage{kpfonts}
\usepackage{hyperref}
\usepackage{algorithmicx}
\usepackage{graphicx}
\usepackage[noend]{algpseudocode}

\hyphenation{me-ta-bo-lism}

% global macro definitions
\newcommand{\TBD}{\textbf{TBD}~}
\newcommand{\spec}[1]{\texttt{#1}}
\renewcommand{\~}[0]{\texttildelow}
\renewcommand{\algorithmiccomment}[1]{\hfill\textit{\# #1}}
\newcommand*\arc{{\fontfamily{pbk}\fontseries{db}\selectfont+}}
\newcommand{\pipe}{{}{\scalebox{.6}{$|$}}{}}
\newcommand{\choice}{|}

\newtheorem{notation}[thm]{Notation}

\def\lastname{Troj\'{a}k et al.}

\begin{document}

% title page
\begin{frontmatter}
\title{Formal Biochemical Space Language}

\author{\normalsize
T. D\v{e}d, D. \v{S}afr\'anek, M. Troj\'ak, M. Klement, J. \v{S}alagovi\v{c}, L. Brim}
\address{Faculty of Informatics, Masaryk University\\
Brno, Czech Republic
}

\end{frontmatter}

\section{Biochemical Space Agents}

note - maybe all compartment could be removed from syntax of agents and added on level of rules

Let $\mathcal{N}_{a},~\mathcal{N}_{T},~\mathcal{N}_{x},~\mathcal{N}_{c},~\mathcal{N}_{s}$ be mutually exclusive finite sets of atomic, structure, complex, compartment, and state names, respectively. 

\subsection{Atomic agents}

Agents are defined hierarchically starting from \emph{atomic agents}. These agents are the smallest units in our hierarchy a represent ...

\begin{definition}
Atomic agent $\mathtt{A}$ is defined as triple ($\alpha, \delta, \mathtt{c}$) where $\alpha \in \mathcal{N}_{A}$ is name, $\delta \subseteq \mathcal{N}_{s}$ is finite non-empty set of states $\mathtt{s} \in \mathcal{N}_{s}$ in which the agent can occur, and $\mathtt{c} \in \mathcal{N}_{c}$ is physical compartment within which it is considered.
\end{definition}

Atomic agent expressions have the following syntax:

\begin{center}
{\small
\hspace*{-1cm}\begin{tabular}{ ll ll ll ll }
 atomic agent & $\mathtt{A} ::= \alpha\{\mathtt{s}\}::\mathtt{c}~\choice~\alpha::\mathtt{c}$ & state & $\mathtt{s} ::= n \in \delta$\\
 name & $\alpha ::= n \in \mathcal{N}_{A}$ & compartment & $\mathtt{c} ::= n \in \mathcal{N}_{c}$\\
\end{tabular}
}
\end{center}

\begin{definition}
Let $\mathtt{A},~\mathtt{A}'$ be atomic agents. We define the \emph{structural equivalence of atomic agents} by claiming $\mathtt{A}\equiv\mathtt{A}'$ whenever $\mathtt{\alpha} = \mathtt{\alpha}'$, $\mathtt{c} = \mathtt{c}'$ and $\delta = \delta'$.
\end{definition}

\begin{notation}
{~}
\begin{itemize}
\item We denote $\mathtt{s}\in\delta$ the fact that $\mathtt{s}$ is included in the state signature~$\delta$.
\item Syntax $\alpha::\mathtt{c}$ is used for expressing atomic agent when state is not specified, i.e. all states $\mathtt{s} \in \delta$ are considered.
\end{itemize}
\end{notation}

\begin{defn}
Let $\mathtt{A},\mathtt{A}'$ be atomic agents. We say agent $\mathtt{A}=(\alpha, \delta, \mathtt{c})$ is \emph{compatible with} agent $\mathtt{A}'=(\alpha', \delta', \mathtt{c}')$, written $\mathtt{A} \lhd \mathtt{A}'$, iff $\alpha = \alpha'$, $\mathtt{c} = \mathtt{c}'$, and $\delta \subseteq \delta'$. 
\end{defn}

\begin{theorem}
Since atomic agents are constructed from finite sets $\mathcal{N}_{A},~\mathcal{N}_{c}$, and $\mathcal{N}_{s}$, we can define universe of atomic agents $\mathcal{A} = \{ \mathtt{A}~|~\mathtt{A} = (\alpha, \delta, \mathtt{c}), \alpha~\in~\mathcal{N}_{A}, \delta~\subseteq~\mathcal{N}_{s},  \mathtt{c}~\in~\mathcal{N}_{c} \}$.
\end{theorem}

\subsection{Structure agents}

Next we proceed with defining \emph{structure agents}. A structure agent represents a biochemical object that is composed from several known atomic agents provided that we know that such a composition is abstract and not necessarily complete. To incorporate such an abstraction of biological structures into our language, a structure agent is defined to be labelled with a unique name and it is constructed only from atomic agents considered in the same physical compartment. 

A typical example of a structure agent is a protein where the atomic agents are individual amino acids that are of interest in the particular setting.

\begin{definition}
Structure agent $\mathtt{T}$ is defined as triple ($\tau, \gamma_p, \mathtt{c}$) where $\tau \in \mathcal{N}_{T}$ is name, $\gamma_p \subseteq \mathcal{A}$ is finite set of atomic agents $\mathtt{A} \in \mathcal{A}$ called \emph{partial composition}, and $\mathtt{c} \in \mathcal{N}_{c}$ is physical compartment within which it is considered.
\end{definition}

Structure agent expressions have the following syntax:

\begin{center}
{\small
\hspace*{-1cm}\begin{tabular}{ ll ll }
 structure agent & $\mathtt{T} ::= \tau(\gamma_p)::\mathtt{c}~\choice~\tau::\mathtt{c}$\\
 structure name & $\tau ::= n \in \mathcal{N}_{T}$\\
 partial composition & $\gamma_p ::= \mathtt{A},~\gamma_p~\choice~\mathtt{A}$\\
\end{tabular}
}
\end{center}   

\begin{notation}
~
\begin{itemize}
\item We denote $\mathtt{A}\in\gamma_p$ the fact that $\gamma_p$ includes the atomic agent $\mathtt{A}$.
\item Structure agent $\mathtt{T} = (\tau, \gamma_p, \mathtt{c})$ might be written as $\tau::\mathtt{c}$ in two special cases:
	\begin{enumerate}
		\item $\gamma_p = \emptyset$,
		\item for each $\mathtt{A} \in \gamma_p$ the state is not specified, i.e. it has form of $\alpha::\mathtt{c}$.
	\end{enumerate}
\end{itemize}
\end{notation}

Note that a compartment of a structure agent is uniquely given by the compartment specified in its parts. We restrict ourselves to structure agents where all atomic agents in the partial composition have the same compartment. Assuming this restriction, we can shorten the notation by omitting compartments in the atomic agents of a partial composition. 

\begin{defn}
Let $\mathtt{T},\mathtt{T}'$ be structure agents. We define the \emph{structural equivalence of structure agents} by claiming $\mathtt{T}\equiv\mathtt{T}'$ iff there exist $\tau,\tau',\gamma_p,\gamma'_p,\mathtt{c},\mathtt{c}'$ such that $\mathtt{T}=(\tau, \gamma_p, \mathtt{c}),\mathtt{T}'=(\tau', \gamma_p', \mathtt{c}')$, $\tau=\tau'$, $\mathtt{c} = \mathtt{c}'$, and $\gamma_p=\gamma'_p$.
\end{defn}

\begin{defn}
Let $\mathtt{T},\mathtt{T}'$ be structure agents. We say $\mathtt{T}$ \emph{is compatible with} $\mathtt{T}'$, written $\mathtt{T} \lhd \mathtt{T}'$, iff there exist $\tau,\tau',\gamma_p,\gamma'_p,\mathtt{c},\mathtt{c}'$ such that $\mathtt{T}=(\tau, \gamma_p, \mathtt{c}),\mathtt{T}'=(\tau', \gamma_p', \mathtt{c}')$, $\tau = \tau'$, $\mathtt{c} = \mathtt{c}'$, and for each atomic agent $\mathtt{A} \in \gamma_p$ there exists an atomic agent $\mathtt{A}' \in \gamma'_p$ such that $\mathtt{A}~\lhd~\mathtt{A}'$. 
\end{defn}

\begin{theorem}
Since structure agents are constructed from finite sets $\mathcal{N}_{T},~\mathcal{N}_{c}$, and $\mathcal{A}$, we can define universe of structure agents $\mathcal{T} = \{ \mathtt{T}~|~\mathtt{T} = (\tau, \gamma_p, \mathtt{c}), \tau~\in~\mathcal{N}_{T}, \gamma_p~\subseteq~\mathcal{A},  \mathtt{c}~\in~\mathcal{N}_{c} \}$.
\end{theorem}

\subsection{Complex agents}

In the following we define the last step in the hierarchy of agents. In particular, we define \textit{complex agents}. A complex agent represents a non-trivial composite biochemical object that is (inductively) constructed from already known biological objects. In common rule-based languages this is typically defined by introducing some kind of bonds between individual biochemical objects. In BCS we abstract from detailed specification of bonds and we rather assume a complex as a coexistence of certain objects in a particular group. Such a group can be optionally referred to by a unique name. A complex agent is constructed from atomic and structure agents.

\begin{definition}
Complex agent $\mathtt{X}$ is defined as triple ($\chi, \gamma_f, \mathtt{c}$) where $\chi \in \mathcal{N}_{x} \cup \{\varepsilon\}$ is name, $\gamma_f \subseteq \mathcal{A} \cup \mathcal{T}$ is finite ordered multiset of atomic and structure agents called \emph{full composition} ordered by complex agent expression, and $\mathtt{c} \in \mathcal{N}_{c}$ is physical compartment within which it is considered.
\end{definition}

Complex agent expressions have the following syntax:

\begin{center}
{\small
\hspace*{-1 cm}\begin{tabular}{ ll ll }
 complex agent & $\mathtt{X}::=\gamma_f::\mathtt{c}~|~\chi::\mathtt{c}$\\
 full composition & $\gamma_f ::= \mathtt{T}.\mathtt{T}~|~\mathtt{A}.\mathtt{A}~|~\mathtt{T}.\gamma_{f}~|~\mathtt{A}.\gamma_{f}$
\end{tabular}
}
\end{center}

In contrast to partial compositions, we allow replication at the level of full compositions (an agent of a certain name can appear more than once in a full composition). Moreover, names of complex agents are not associated with particular full compositions at the level of agent expressions.

Note that a compartment of a complex agent is uniquely given by the compartment specified in its parts. We restrict ourselves to complex agents where all atomic and structure agents in the full composition have the same compartment. Assuming this restriction, we can shorten the notation by omitting compartments in the atomic and structure agents of a full composition. 

\begin{notation}
~
\begin{itemize}
\item  We denote $\mathtt{T}\in \mathtt{X}$ (resp. $\mathtt{A}\in \mathtt{X}$) the fact that~$\mathtt{T}$ (resp. $\mathtt{A}$) is a structure agent (resp. atomic agent) included in~$\gamma_f$ (resp. in~$\gamma_p$). 
Moreover, we denote $\#\mathtt{T}[\mathtt{X}]$ (resp. $\#\mathtt{A}[\mathtt{X}]$) the number of occurrences of~$\mathtt{T}$ (resp. $\mathtt{A}$) in $\gamma_f$. 
\item We denote $\mathtt{X}' \in \mathtt{X}$ the fact that full composition of $\mathtt{X}'$ is subexpression in full composition of $\mathtt{X}$.
\item An complex agent might be referenced both via its name $\chi$ (if $\chi \neq \varepsilon$) and $\gamma_f$.
\end{itemize}
\end{notation}

\begin{defn}
Let $\mathtt{X},\mathtt{X}'$ be structure agents. We define the \emph{structural equivalence of structure agents} by claiming $\mathtt{X} \equiv \mathtt{X}'$ iff there exist $\chi,\chi',\gamma_f,\gamma'_f, \mathtt{c},\mathtt{c}'$ such that $\mathtt{X}=(\chi, \gamma_f, \mathtt{c}),\mathtt{T}'=(\chi', \gamma_f', \mathtt{c}')$, $\chi=\chi'$, $\mathtt{c} = \mathtt{c}'$, and $\gamma_f=\gamma'_f$ (regardless the order).
\end{defn}

\begin{defn}
Let $\mathtt{X} = (\chi, \gamma_f, \mathtt{c}), \mathtt{X}' = (\chi', \gamma_f', \mathtt{c}')$ be complex agents. We say $\mathtt{X}$ \emph{is compatible with} $\mathtt{X}'$, written $\mathtt{X} \lhd \mathtt{X}'$, iff $\chi=\chi'$, $\mathtt{c} = \mathtt{c}'$, and $\forall \beta_1, \beta_2, ..., \beta_n \in \gamma_f $ and $\forall \beta_1', \beta_2', ..., \beta_n' \in \gamma'_f$ : $\beta_i \lhd \beta_i'$. 
\end{defn}

\begin{theorem}
Since complex agents are constructed from finite sets $\mathcal{N}_{x},~\mathcal{N}_{c}$, $\mathcal{A}$, and $\mathcal{T}$, we can define universe of complex agents $\mathcal{X} = \{ \mathtt{X}~|~\mathtt{X} = (\chi, \gamma_f, \mathtt{c}), \chi~\in~\mathcal{N}_{x} \cup \{\varepsilon\}, \gamma_f \subseteq \mathcal{A} \cup \mathcal{T},  \mathtt{c}~\in~\mathcal{N}_{c} \}$.
\end{theorem}

\section{Biochemical Space Rules}

\begin{definition}
Rule $\mathtt{R}$ is defined as triple ($\lambda, \rho, \nu$) where $\lambda, \rho, \nu \subseteq \mathcal{X} \cup \mathcal{T} \cup \mathcal{A} \cup \{\varepsilon\}$ and $\lambda$ is \emph{left-hand-side} of the rule, $\rho$ is \emph{right-hand-side} of the rule, and $\nu$ is \emph{variable}. Both $\lambda$ and $\rho$ are ordered sets where order is given by rule expression and at most one of them might be $\varepsilon$.
\end{definition}

Rule expressions have the following syntax:

\begin{center}
{\small
\hspace*{-1cm}\begin{tabular}{ l l }
 rule expression & $\mathtt{R} ::= \lambda ~\odot~ \rho~\nu ~|~ \lambda ~\odot~\nu ~|~ \odot~ \rho~\nu $\\
  & $\lambda ::= \Gamma$\\
  & $\rho ::= \Gamma$\\
  & $\nu ::=~ ;~\upsilon ~|~ \varepsilon$\\
 direction & $\odot ::=~ \Rightarrow~|~\Leftrightarrow $\\
  & $\Gamma ::= \zeta~\varphi~ +~\Gamma ~|~ \zeta~\varphi$\\
 stoichiometry & $\zeta ::= n \in \mathbb{N}^+$\\
 rule agent & $\varphi :: = \varphi_1~|~\varphi_2~|~\varphi_1::\xi~|~\varphi_2::\xi'~|~\xi'$\\
  & $\varphi_1  ~::=~  ?\nu_1~|~?\nu_2~|~?\nu_3~|~\mathtt{A}::~?\nu_2~|~?\nu_1::\mathtt{T}$\\
  & $\xi' ~::=~ \mathtt{X}::\xi'~|~?\nu_3::\xi~|~?\nu_3~|~\xi$\\
  & $\varphi_2  ~::=~  \mathtt{A}~|~\mathtt{T}~|~\mathtt{X}~|~\mathtt{A}::\mathtt{T}$\\
  & $\xi  ~::=~  \mathtt{X}::\xi~|~\mathtt{X}$\\
 variable & $\upsilon ::=~?\nu_1=\{\phi_1\}~|~?\nu_2=\{\phi_2\}~|~?\nu_3=\{\phi_3\}$\\
  & $\phi_1 ::= \mathtt{A},~\phi_1~|~\mathtt{A}$\\
  & $\phi_2 ::= \mathtt{T},~\phi_2~|~\mathtt{T}$\\
  & $\phi_3 ::= \mathtt{X},~\phi_3~|~\mathtt{X}$\\
\end{tabular}
}
\end{center}

\begin{defn}
Let $\mathtt{R},\mathtt{R}'$ be rules. We define the \emph{structural equivalence of rules} by claiming $\mathtt{R} \equiv \mathtt{R}'$ iff there exist $\lambda, \lambda', \rho, \rho', \nu, \nu'$ such that $\mathtt{R}=(\lambda, \rho, \nu),\mathtt{R}'=(\lambda', \rho', \nu')$, $\chi=\chi'$, $\nu = \nu'$, $\lambda=\lambda'$ (regardless the order) and $\rho=\rho'$ (regardless the order).
\end{defn}

\begin{definition}
Let $\varphi$ be a rule agent that appears in a rule $\mathtt{R}$. The \emph{rule agent} $\varphi$ is \emph{well-formed} iff the following constrains are satisfied:

\begin{enumerate}
 \item If $\mathtt{A}::\mathtt{T}$ is a subexpression of $\varphi$ and $\mathtt{T} = \tau(\gamma_p)::\mathtt{c}$ then exists $\mathtt{A}' \in \gamma_p$ such that $\mathtt{A} \lhd \mathtt{A}'$.

\item If $\mathtt{T}::\mathtt{X}$ is a subexpression of $\varphi$ then exists $\mathtt{T}' \in \mathtt{X}$ such that $\mathtt{T} \lhd \mathtt{T}'$.

\item If $\mathtt{A}::\mathtt{X}$ is a subexpression of $\varphi$ then exists $\mathtt{A}' \in \mathtt{X}$ such that $\mathtt{A} \lhd \mathtt{A}'$.

\item If $\mathtt{X}'::\mathtt{X}$ is a subexpression of $\varphi$ then exists $\mathtt{X}'' \in \mathtt{X}$ such that $\mathtt{X}' \lhd \mathtt{X}''$.

\end{enumerate}

\end{definition}

\begin{definition}[Rule Flattening]
Let $(\Sigma_\tau,\Sigma_x)$ be a signature and $\mathtt{R}$ a set of rules. Every rule $r\in\mathtt{R}$ that includes some \emph{nested} rule agents $\varphi$ can be reduced to a rule $r'\in\mathtt{R}$ where every rule agent $\varphi$ is in \emph{basic} form. For every subexpression $\beta$ in every rule agent $\varphi$ in $r$, the reduction is done recursively by replacing $\beta$ with $\beta'$ in the following way:
\begin{enumerate}
\item If $\beta=\mathtt{A}::\mathtt{T}$ where $\mathtt{T}=\tau(\gamma_p)$ for some $\tau,\gamma_p$ then there must exist $\mathtt{A}'\in\gamma_p$ such that $\mathtt{A}\lhd\mathtt{A}'$. Then we set $\beta'={\tau}(\gamma'_p)$ where $\gamma'_p$ is constructed from $\gamma_p$ by replacing $\mathtt{A}'\in\gamma_p$ with $\mathtt{A}$.
\item If $\beta=\mathtt{T}::\mathtt{X}$ where $\mathtt{X}=\gamma_f$ then there must exist $\mathtt{T}'\in\gamma_f$ such that $\mathtt{T}\lhd\mathtt{T}'$. Then we set $\beta'=\gamma'_f$ where $\gamma'_f$ is constructed from $\gamma_f$ by replacing $\mathtt{T}'\in\gamma_f$ with $\mathtt{T}$. 
\item If $\beta=\mathtt{A}::\mathtt{X}$ where $\mathtt{X}=\gamma_f$ then there must exist $\mathtt{A}'\in\gamma_f$ such that $\mathtt{A}\lhd\mathtt{A}'$. Then we set $\beta'=\gamma'_f$ where $\gamma'_f$ is constructed from $\gamma_f$ by replacing $\mathtt{A}'\in\gamma_f$ with $\mathtt{A}$. 
\item If $\beta=\mathtt{X}'::\mathtt{X}$ where $\mathtt{X}=\gamma_f$ and $\mathtt{X}'= \gamma'_f$ then for every $\mathtt{T} \in \gamma_f$ (resp. $\mathtt{A} \in \gamma_f$) there must exist $\mathtt{T}' \in \gamma'_f$ (resp. $\mathtt{A}' \in \gamma'_f$) such that $\mathtt{T} \lhd \mathtt{T}'$ (resp. $\mathtt{A} \lhd \mathtt{A}'$). Then we set $\beta'=\gamma_{f'}$ where $\gamma_{f'}$ is constructed from $\gamma_f$ by replacing all $\mathtt{T} \in \gamma_f$ (resp. $\mathtt{A} \in \gamma_f$) with appropriate $\mathtt{T}' \in \gamma'_f$  (resp. $\mathtt{A}' \in \gamma'_f$).
\end{enumerate} 
\end{definition}

\end{document}
